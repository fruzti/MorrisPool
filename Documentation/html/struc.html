<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Estructura de MorrisPool &mdash; OpenFieldTest 2.1.4 documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '2.1.4',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="OpenFieldTest 2.1.4 documentation" href="index.html" />
    <link rel="next" title="Getting started" href="install.html" />
    <link rel="prev" title="Funciones de MorrisPool" href="functions.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="install.html" title="Getting started"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="functions.html" title="Funciones de MorrisPool"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">OpenFieldTest 2.1.4 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="estructura-de-morrispool">
<span id="getting-started"></span><h1>Estructura de MorrisPool<a class="headerlink" href="#estructura-de-morrispool" title="Permalink to this headline">¶</a></h1>
<p>El programa consiste básicamente de siete archivos:
- BasicClases.py
- MainApp.py
- MorrisPool.py
- Pool.py
- PolarCoords.py
- VideoFile.py
- DrawOutput.py</p>
<p>y un archivo wrapper o de inicio: <strong>MainFile</strong>.</p>
<div class="section" id="basicclases-py">
<h2>BasicClases.py<a class="headerlink" href="#basicclases-py" title="Permalink to this headline">¶</a></h2>
<p>Contiene las clases y funciones básicas usadas por el programa. Contiene funciones de apoyo para analizar el experimento y las necesarias para la generación de gráficas y reportes.</p>
</div>
<div class="section" id="drawoutput-py">
<h2>DrawOutput.py<a class="headerlink" href="#drawoutput-py" title="Permalink to this headline">¶</a></h2>
<p>Esta clase es la encargada de seleccionar que tipo de imagen se generará al final del experimento.</p>
</div>
<div class="section" id="videofile-py">
<h2>VideoFile.py<a class="headerlink" href="#videofile-py" title="Permalink to this headline">¶</a></h2>
<p>Este archivo contiene una clase para la manipulación del video. Su utilización principal es para DEBUG, pero puede ser utilizada para suplir la necesidad de contar con el video. Aquí se piensa implementar una solución on-line al experimento.</p>
</div>
<div class="section" id="polarcoords-py">
<h2>PolarCoords.py<a class="headerlink" href="#polarcoords-py" title="Permalink to this headline">¶</a></h2>
<p>Esta clase es utilizada para calcular los fantasmas del Target. Contiene los métodos matemáticos, en coordenadas polares, para encontrar las representaciones de las áreas homologas al del Target en los otros cuadrantes.</p>
</div>
<div class="section" id="mainapp-py">
<h2>MainApp.py<a class="headerlink" href="#mainapp-py" title="Permalink to this headline">¶</a></h2>
<p>Este archivo contiene las rutinas necesarias para la creación de la interfaz gráfica y del recorte del video.</p>
</div>
<div class="section" id="morrispool-py">
<h2>MorrisPool.py<a class="headerlink" href="#morrispool-py" title="Permalink to this headline">¶</a></h2>
<p>Contiene la clase y métodos necesarios para comenzar el análisis para el experimento. Es aquí donde el trayecto del ratón es calculado y el reporte es generado.</p>
</div>
<div class="section" id="pool-py">
<h2>Pool.py<a class="headerlink" href="#pool-py" title="Permalink to this headline">¶</a></h2>
<p>Es aquí donde la clase que se encarga de realizar el análisis del experimento de transferencia es implementada.</p>
</div>
<div class="section" id="mainfile-py">
<h2>MainFile.py<a class="headerlink" href="#mainfile-py" title="Permalink to this headline">¶</a></h2>
<p>Finalmente, este Script es el encargado de poner todo junto y de interactuar con el usuario. Consta del llamado de todas las clases necesarias para el análisis y para escoger si la prueba se trata de una de transferencia o no.
Además, es aquí donde se llama a la rutina para guardar la imagen final de salida.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">#############################################################################</span>
<span class="c"># Copyright 2014 by Mario Coutino                                           #</span>
<span class="c">#                                                                           #</span>
<span class="c">#                        All Rights Reserved                                #</span>
<span class="c">#                                                                           #</span>
<span class="c"># Permission to use, copy, modify, and distribute this software and         #</span>
<span class="c"># its documentation for any purpose and without fee is hereby               #</span>
<span class="c"># granted, provided that the above copyright notice appear in all           #</span>
<span class="c"># copies and that both that copyright notice and this permission            #</span>
<span class="c"># notice appear in supporting documentation, and that the name of Mario     #</span>
<span class="c"># Coutino not be used in advertising or publicity pertaining to             #</span>
<span class="c"># distribution of the software without specific, written prior              #</span>
<span class="c"># permission.                                                               #</span>
<span class="c">#                                                                           #</span>
<span class="c"># MARIO COUTINO DISCLAIMS ALL WARRANTIES WITH REGARD TO THIS SOFTWARE,      #</span>
<span class="c"># INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS, IN       #</span>
<span class="c"># NO EVENT SHALL MARIO COUTINO BE LIABLE FOR ANY SPECIAL, INDIRECT OR       #</span>
<span class="c"># CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS       #</span>
<span class="c"># OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT,                #</span>
<span class="c"># NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF OR IN                 #</span>
<span class="c"># CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.                  #</span>
<span class="c">#############################################################################</span>

<span class="kn">from</span> <span class="nn">MainApp</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">MorrisPool</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">BasicClases</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">Pool</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">DrawOutput</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">cv2</span>

<span class="k">def</span> <span class="nf">createBasePhoto</span><span class="p">(</span><span class="n">filePath</span><span class="p">,</span><span class="n">img</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Helper function to create the image to mark the target&#39;s position.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">basePath</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
    <span class="n">pathParts</span> <span class="o">=</span> <span class="n">filePath</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">pathParts</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
        <span class="n">basePath</span> <span class="o">+=</span> <span class="n">el</span> <span class="o">+</span> <span class="s">&#39;/&#39;</span>
    <span class="n">basePath</span> <span class="o">+=</span> <span class="s">&#39;basePhoto.png&#39;</span>

    <span class="k">return</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imwrite</span><span class="p">(</span><span class="n">basePath</span><span class="p">,</span> <span class="n">img</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">convListToTuple</span><span class="p">(</span><span class="n">l</span><span class="p">):</span>
    <span class="n">t</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span>  <span class="n">l</span><span class="p">:</span>
        <span class="n">t</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">e</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">e</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
    <span class="k">return</span> <span class="n">t</span>

<span class="c">#-------------------------------------------------------------------------------</span>
<span class="n">videoSequence</span> <span class="o">=</span> <span class="bp">None</span>
<span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
<span class="n">mousePath</span> <span class="o">=</span> <span class="bp">None</span>
<span class="n">morrisPool</span> <span class="o">=</span> <span class="bp">None</span>
<span class="c">#-------------------------------------------------------------------------------</span>

<span class="k">print</span> <span class="s">&#39;Iniciando Aplicacion&#39;</span>
<span class="n">w</span> <span class="o">=</span> <span class="n">MainApp</span><span class="p">()</span>

<span class="n">videoSequence</span> <span class="o">=</span> <span class="n">w</span><span class="o">.</span><span class="n">getVideoSequence</span><span class="p">()</span>
<span class="p">(</span><span class="n">start</span><span class="p">,</span><span class="n">end</span><span class="p">)</span> <span class="o">=</span> <span class="n">w</span><span class="o">.</span><span class="n">getSequenceBoundaries</span><span class="p">()</span>

<span class="k">print</span> <span class="s">&#39;Creando Entorno&#39;</span>
<span class="k">print</span> <span class="s">&#39;---------------------------&#39;</span>
<span class="n">morrisPool</span> <span class="o">=</span> <span class="n">MorrisPool</span><span class="p">(</span><span class="n">videoSequence</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>

<span class="k">print</span> <span class="s">&#39;Comenzando Deteccion&#39;</span>
<span class="k">print</span> <span class="s">&#39;---------------------------&#39;</span>
<span class="n">morrisPool</span><span class="o">.</span><span class="n">startTracking</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>

<span class="n">morrisPool</span><span class="o">.</span><span class="n">getRealDistance2</span><span class="p">(</span><span class="n">w</span><span class="o">.</span><span class="n">getPathName</span><span class="p">())</span>

<span class="n">mousePath</span> <span class="o">=</span> <span class="n">morrisPool</span><span class="o">.</span><span class="n">getMousePath</span><span class="p">()</span>

<span class="n">generateReport</span><span class="p">(</span><span class="n">mousePath</span><span class="p">,</span> <span class="n">morrisPool</span><span class="o">.</span><span class="n">getRealDistance</span><span class="p">(),</span> <span class="n">morrisPool</span><span class="o">.</span><span class="n">getConvFactor</span><span class="p">())</span>

<span class="k">print</span> <span class="s">&#39;Total Swimming Time[s]: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">morrisPool</span><span class="o">.</span><span class="n">getVideoTimeInS</span><span class="p">())</span>

<span class="n">op</span> <span class="o">=</span> <span class="nb">raw_input</span><span class="p">(</span><span class="s">&#39;Transfer Experiment? [y/n]: &#39;</span><span class="p">)</span>
<span class="n">op</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

<span class="k">if</span> <span class="n">op</span> <span class="o">==</span> <span class="s">&#39;y&#39;</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&#39;Continue with Transference Analysis&#39;</span>
    <span class="k">print</span> <span class="s">&#39;------------------------------------&#39;</span>
    <span class="p">(</span><span class="n">centre</span><span class="p">,</span> <span class="n">rad</span><span class="p">)</span> <span class="o">=</span> <span class="n">morrisPool</span><span class="o">.</span><span class="n">getPoolPosition</span><span class="p">()</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">Pool</span><span class="p">(</span><span class="n">centre</span><span class="p">,</span> <span class="n">convListToTuple</span><span class="p">(</span><span class="n">mousePath</span><span class="p">),</span> <span class="n">w</span><span class="o">.</span><span class="n">getPathName</span><span class="p">())</span>
    <span class="n">p</span><span class="o">.</span><span class="n">analyseMousePath</span><span class="p">()</span>
    <span class="n">p</span><span class="o">.</span><span class="n">showPath</span><span class="p">()</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">DrawOutput</span><span class="p">(</span><span class="n">morrisPool</span><span class="o">.</span><span class="n">poolRadio</span><span class="p">,</span> <span class="n">morrisPool</span><span class="o">.</span><span class="n">poolCenter</span><span class="p">,</span>
        <span class="n">p</span><span class="o">.</span><span class="n">targetPosition</span><span class="p">,</span><span class="n">morrisPool</span><span class="o">.</span><span class="n">mousePathA</span><span class="p">)</span>
    <span class="n">p</span><span class="o">.</span><span class="n">generateReport</span><span class="p">()</span>
    <span class="k">print</span> <span class="s">&#39;Analysis Finished&#39;</span>
    <span class="k">print</span> <span class="s">&#39;------------------------------------&#39;</span>
    <span class="k">print</span> <span class="s">&#39;Done!&#39;</span>

<span class="k">else</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&#39;Creating Base Image...&#39;</span>
    <span class="k">print</span> <span class="s">&#39;------------------------------------&#39;</span>
    <span class="n">createBasePhoto</span><span class="p">(</span><span class="n">w</span><span class="o">.</span><span class="n">getPathName</span><span class="p">(),</span> <span class="n">videoSequence</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="p">(</span><span class="n">centre</span><span class="p">,</span> <span class="n">rad</span><span class="p">)</span> <span class="o">=</span> <span class="n">morrisPool</span><span class="o">.</span><span class="n">getPoolPosition</span><span class="p">()</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">Pool</span><span class="p">(</span><span class="n">centre</span><span class="p">,</span> <span class="n">convListToTuple</span><span class="p">(</span><span class="n">mousePath</span><span class="p">),</span> <span class="n">w</span><span class="o">.</span><span class="n">getPathName</span><span class="p">())</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">DrawOutput</span><span class="p">(</span><span class="n">morrisPool</span><span class="o">.</span><span class="n">poolRadio</span><span class="p">,</span> <span class="n">morrisPool</span><span class="o">.</span><span class="n">poolCenter</span><span class="p">,</span>
        <span class="n">p</span><span class="o">.</span><span class="n">targetPosition</span><span class="p">,</span><span class="n">morrisPool</span><span class="o">.</span><span class="n">mousePathA</span><span class="p">)</span>
<span class="k">print</span> <span class="s">&#39;Done!&#39;</span>
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Estructura de MorrisPool</a><ul>
<li><a class="reference internal" href="#basicclases-py">BasicClases.py</a></li>
<li><a class="reference internal" href="#drawoutput-py">DrawOutput.py</a></li>
<li><a class="reference internal" href="#videofile-py">VideoFile.py</a></li>
<li><a class="reference internal" href="#polarcoords-py">PolarCoords.py</a></li>
<li><a class="reference internal" href="#mainapp-py">MainApp.py</a></li>
<li><a class="reference internal" href="#morrispool-py">MorrisPool.py</a></li>
<li><a class="reference internal" href="#pool-py">Pool.py</a></li>
<li><a class="reference internal" href="#mainfile-py">MainFile.py</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="functions.html"
                        title="previous chapter">Funciones de MorrisPool</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="install.html"
                        title="next chapter">Getting started</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/struc.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="install.html" title="Getting started"
             >next</a> |</li>
        <li class="right" >
          <a href="functions.html" title="Funciones de MorrisPool"
             >previous</a> |</li>
        <li><a href="index.html">OpenFieldTest 2.1.4 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2014, Mario Coutino.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.
    </div>
  </body>
</html>